// This file was autogenerated by tools/schema/gen_supported_message.js
// DO NOT EDIT THIS FILE

use std::io::{Read, Write};

use crate::{
    encoding::*,
    node_id::NodeId,
    service_types::*,
    node_ids::ObjectId,
    tcp_types::AcknowledgeMessage,
};

/// This macro helps avoid tedious repetition as new messages are added
/// The first form just handles the trailing comma after the last entry to save some pointless
/// editing when new messages are added to the list.
macro_rules! supported_messages_enum {
    [ $( $x:ident, ) * ] => (supported_messages_enum![ $( $x ),* ];);
    [ $( $x:ident ), * ] => {
        #[derive(Debug, PartialEq, Clone)]
        pub enum SupportedMessage {
            /// An invalid request / response of some form
            Invalid(ObjectId),
            /// Acknowledge message
            AcknowledgeMessage(AcknowledgeMessage),
            /// Other messages
            $( $x($x), )*
        }

        impl BinaryEncoder <SupportedMessage> for SupportedMessage {
            fn byte_len(&self) -> usize {
                match *self {
                    SupportedMessage::Invalid(object_id) => {
                        panic!("Unsupported message byte_len {:?}", object_id);
                    },
                    SupportedMessage::AcknowledgeMessage(ref value) => value.byte_len(),
                    $( SupportedMessage::$x(ref value) => value.byte_len(), )*
                }
            }

            fn encode<S: Write>(&self, stream: &mut S) -> EncodingResult<usize> {
                match *self {
                    SupportedMessage::Invalid(object_id) => {
                        panic!("Unsupported message encode {:?}", object_id);
                    },
                    SupportedMessage::AcknowledgeMessage(ref value) => value.encode(stream),
                    $( SupportedMessage::$x(ref value) => value.encode(stream), )*
                }
            }

            fn decode<S: Read>(_: &mut S, _: &DecodingLimits) -> EncodingResult<Self> {
                // THIS WILL NOT DO ANYTHING
                panic!("Cannot decode a stream to a supported message type");
            }
        }
        
        $(
        impl Into<SupportedMessage> for $x {
            fn into(self) -> SupportedMessage { SupportedMessage::$x(self) }
        }
        )*

        impl SupportedMessage {
            pub fn node_id(&self) -> NodeId {
                match *self {
                    SupportedMessage::Invalid(object_id) => {
                        panic!("Unsupported message invalid, node_id {:?}", object_id);
                    },
                    SupportedMessage::AcknowledgeMessage(ref value) => {
                        panic!("Unsupported message node_id {:?}", value);
                    },
                    $( SupportedMessage::$x(ref value) => value.object_id().into(), )*
                }
            }
        }
    }
}

impl SupportedMessage {
    pub fn request_handle(&self) -> u32 {
        match *self {
            SupportedMessage::Invalid(_) | SupportedMessage::AcknowledgeMessage(_) => 0,
            SupportedMessage::ServiceFault(ref r) => r.response_header.request_handle,
            SupportedMessage::OpenSecureChannelRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::OpenSecureChannelResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::CloseSecureChannelRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::CloseSecureChannelResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::GetEndpointsRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::GetEndpointsResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::FindServersRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::FindServersResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::RegisterServerRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::RegisterServerResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::CreateSessionRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::CreateSessionResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::CloseSessionRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::CloseSessionResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::ActivateSessionRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::ActivateSessionResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::CancelRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::CancelResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::CreateMonitoredItemsRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::CreateMonitoredItemsResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::ModifyMonitoredItemsRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::ModifyMonitoredItemsResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::DeleteMonitoredItemsRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::DeleteMonitoredItemsResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::CreateSubscriptionRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::CreateSubscriptionResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::ModifySubscriptionRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::ModifySubscriptionResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::DeleteSubscriptionsRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::DeleteSubscriptionsResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::SetPublishingModeRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::SetPublishingModeResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::BrowseRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::BrowseResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::BrowseNextRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::BrowseNextResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::PublishRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::PublishResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::RepublishRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::RepublishResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::TranslateBrowsePathsToNodeIdsRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::TranslateBrowsePathsToNodeIdsResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::ReadRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::ReadResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::WriteRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::WriteResponse(ref r) => r.response_header.request_handle,
            SupportedMessage::CallRequest(ref r) => r.request_header.request_handle,
            SupportedMessage::CallResponse(ref r) => r.response_header.request_handle,
        }
    }

    pub fn decode_by_object_id<S: Read>(stream: &mut S, object_id: ObjectId, decoding_limits: &DecodingLimits) -> EncodingResult<Self> {
        trace!("decoding object_id {:?}", object_id);
        let decoded_message = match object_id {
            ObjectId::ServiceFault_Encoding_DefaultBinary => {
                SupportedMessage::ServiceFault(ServiceFault::decode(stream, decoding_limits)?)
            }
            ObjectId::OpenSecureChannelRequest_Encoding_DefaultBinary => {
                SupportedMessage::OpenSecureChannelRequest(OpenSecureChannelRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::OpenSecureChannelResponse_Encoding_DefaultBinary => {
                SupportedMessage::OpenSecureChannelResponse(OpenSecureChannelResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::CloseSecureChannelRequest_Encoding_DefaultBinary => {
                SupportedMessage::CloseSecureChannelRequest(CloseSecureChannelRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::CloseSecureChannelResponse_Encoding_DefaultBinary => {
                SupportedMessage::CloseSecureChannelResponse(CloseSecureChannelResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::GetEndpointsRequest_Encoding_DefaultBinary => {
                SupportedMessage::GetEndpointsRequest(GetEndpointsRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::GetEndpointsResponse_Encoding_DefaultBinary => {
                SupportedMessage::GetEndpointsResponse(GetEndpointsResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::FindServersRequest_Encoding_DefaultBinary => {
                SupportedMessage::FindServersRequest(FindServersRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::FindServersResponse_Encoding_DefaultBinary => {
                SupportedMessage::FindServersResponse(FindServersResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::RegisterServerRequest_Encoding_DefaultBinary => {
                SupportedMessage::RegisterServerRequest(RegisterServerRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::RegisterServerResponse_Encoding_DefaultBinary => {
                SupportedMessage::RegisterServerResponse(RegisterServerResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::CreateSessionRequest_Encoding_DefaultBinary => {
                SupportedMessage::CreateSessionRequest(CreateSessionRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::CreateSessionResponse_Encoding_DefaultBinary => {
                SupportedMessage::CreateSessionResponse(CreateSessionResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::CloseSessionRequest_Encoding_DefaultBinary => {
                SupportedMessage::CloseSessionRequest(CloseSessionRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::CloseSessionResponse_Encoding_DefaultBinary => {
                SupportedMessage::CloseSessionResponse(CloseSessionResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::ActivateSessionRequest_Encoding_DefaultBinary => {
                SupportedMessage::ActivateSessionRequest(ActivateSessionRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::ActivateSessionResponse_Encoding_DefaultBinary => {
                SupportedMessage::ActivateSessionResponse(ActivateSessionResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::CancelRequest_Encoding_DefaultBinary => {
                SupportedMessage::CancelRequest(CancelRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::CancelResponse_Encoding_DefaultBinary => {
                SupportedMessage::CancelResponse(CancelResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::CreateMonitoredItemsRequest_Encoding_DefaultBinary => {
                SupportedMessage::CreateMonitoredItemsRequest(CreateMonitoredItemsRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::CreateMonitoredItemsResponse_Encoding_DefaultBinary => {
                SupportedMessage::CreateMonitoredItemsResponse(CreateMonitoredItemsResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::ModifyMonitoredItemsRequest_Encoding_DefaultBinary => {
                SupportedMessage::ModifyMonitoredItemsRequest(ModifyMonitoredItemsRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::ModifyMonitoredItemsResponse_Encoding_DefaultBinary => {
                SupportedMessage::ModifyMonitoredItemsResponse(ModifyMonitoredItemsResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::DeleteMonitoredItemsRequest_Encoding_DefaultBinary => {
                SupportedMessage::DeleteMonitoredItemsRequest(DeleteMonitoredItemsRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::DeleteMonitoredItemsResponse_Encoding_DefaultBinary => {
                SupportedMessage::DeleteMonitoredItemsResponse(DeleteMonitoredItemsResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::CreateSubscriptionRequest_Encoding_DefaultBinary => {
                SupportedMessage::CreateSubscriptionRequest(CreateSubscriptionRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::CreateSubscriptionResponse_Encoding_DefaultBinary => {
                SupportedMessage::CreateSubscriptionResponse(CreateSubscriptionResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::ModifySubscriptionRequest_Encoding_DefaultBinary => {
                SupportedMessage::ModifySubscriptionRequest(ModifySubscriptionRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::ModifySubscriptionResponse_Encoding_DefaultBinary => {
                SupportedMessage::ModifySubscriptionResponse(ModifySubscriptionResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::DeleteSubscriptionsRequest_Encoding_DefaultBinary => {
                SupportedMessage::DeleteSubscriptionsRequest(DeleteSubscriptionsRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::DeleteSubscriptionsResponse_Encoding_DefaultBinary => {
                SupportedMessage::DeleteSubscriptionsResponse(DeleteSubscriptionsResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::SetPublishingModeRequest_Encoding_DefaultBinary => {
                SupportedMessage::SetPublishingModeRequest(SetPublishingModeRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::SetPublishingModeResponse_Encoding_DefaultBinary => {
                SupportedMessage::SetPublishingModeResponse(SetPublishingModeResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::BrowseRequest_Encoding_DefaultBinary => {
                SupportedMessage::BrowseRequest(BrowseRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::BrowseResponse_Encoding_DefaultBinary => {
                SupportedMessage::BrowseResponse(BrowseResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::BrowseNextRequest_Encoding_DefaultBinary => {
                SupportedMessage::BrowseNextRequest(BrowseNextRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::BrowseNextResponse_Encoding_DefaultBinary => {
                SupportedMessage::BrowseNextResponse(BrowseNextResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::PublishRequest_Encoding_DefaultBinary => {
                SupportedMessage::PublishRequest(PublishRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::PublishResponse_Encoding_DefaultBinary => {
                SupportedMessage::PublishResponse(PublishResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::RepublishRequest_Encoding_DefaultBinary => {
                SupportedMessage::RepublishRequest(RepublishRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::RepublishResponse_Encoding_DefaultBinary => {
                SupportedMessage::RepublishResponse(RepublishResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::TranslateBrowsePathsToNodeIdsRequest_Encoding_DefaultBinary => {
                SupportedMessage::TranslateBrowsePathsToNodeIdsRequest(TranslateBrowsePathsToNodeIdsRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::TranslateBrowsePathsToNodeIdsResponse_Encoding_DefaultBinary => {
                SupportedMessage::TranslateBrowsePathsToNodeIdsResponse(TranslateBrowsePathsToNodeIdsResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::ReadRequest_Encoding_DefaultBinary => {
                SupportedMessage::ReadRequest(ReadRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::ReadResponse_Encoding_DefaultBinary => {
                SupportedMessage::ReadResponse(ReadResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::WriteRequest_Encoding_DefaultBinary => {
                SupportedMessage::WriteRequest(WriteRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::WriteResponse_Encoding_DefaultBinary => {
                SupportedMessage::WriteResponse(WriteResponse::decode(stream, decoding_limits)?)
            }
            ObjectId::CallRequest_Encoding_DefaultBinary => {
                SupportedMessage::CallRequest(CallRequest::decode(stream, decoding_limits)?)
            }
            ObjectId::CallResponse_Encoding_DefaultBinary => {
                SupportedMessage::CallResponse(CallResponse::decode(stream, decoding_limits)?)
            }

            _ => {
                debug!("decoding unsupported for object id {:?}", object_id);
                SupportedMessage::Invalid(object_id)
            }
        };
        Ok(decoded_message)
    }
}

// These are all the messages handled into and out of streams by the OPCUA server / client code
supported_messages_enum![
    ServiceFault,
    OpenSecureChannelRequest,
    OpenSecureChannelResponse,
    CloseSecureChannelRequest,
    CloseSecureChannelResponse,
    CancelRequest,
    CancelResponse,
    GetEndpointsRequest,
    GetEndpointsResponse,
    FindServersRequest,
    FindServersResponse,
    RegisterServerRequest,
    RegisterServerResponse,
    CreateSessionRequest,
    CreateSessionResponse,
    CloseSessionRequest,
    CloseSessionResponse,
    ActivateSessionRequest,
    ActivateSessionResponse,
    CreateMonitoredItemsRequest,
    CreateMonitoredItemsResponse,
    ModifyMonitoredItemsRequest,
    ModifyMonitoredItemsResponse,
    DeleteMonitoredItemsRequest,
    DeleteMonitoredItemsResponse,
    CreateSubscriptionRequest,
    CreateSubscriptionResponse,
    ModifySubscriptionRequest,
    ModifySubscriptionResponse,
    DeleteSubscriptionsRequest,
    DeleteSubscriptionsResponse,
    SetPublishingModeRequest,
    SetPublishingModeResponse,
    BrowseRequest,
    BrowseResponse,
    BrowseNextRequest,
    BrowseNextResponse,
    PublishRequest,
    PublishResponse,
    RepublishRequest,
    RepublishResponse,
    TranslateBrowsePathsToNodeIdsRequest,
    TranslateBrowsePathsToNodeIdsResponse,
    ReadRequest,
    ReadResponse,
    WriteRequest,
    WriteResponse,
    CallRequest,
    CallResponse,
];
